var MusicAPM=function(){"use strict";function o(e){return"[object Array]"===Object.prototype.toString.call(e)}function r(e){return void 0===e}function k(e,t){var n,i,a,o;if(r(e.length))for(n in e)a=e,o=n,Object.prototype.hasOwnProperty.call(a,o)&&t(n,e[n]);else if(i=e.length)for(n=0;n<i;n++)t(n,e[n])}function p(n,e){return e&&k(e,function(e,t){n[e]=t}),n}function t(){var e=window.crypto||window.msCrypto;if(r(e)||!e.getRandomValues)return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)});var t=new Uint16Array(8);e.getRandomValues(t),t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;var n=function(e){for(var t=e.toString(16);t.length<4;)t="0"+t;return t};return n(t[0])+n(t[1])+n(t[2])+n(t[3])+n(t[4])+n(t[5])+n(t[6])+n(t[7])}function f(n,e){return n&&e?(a=e,"[object String]"===Object.prototype.toString.call(a)||e instanceof RegExp?n.replace(e,""):(i=e,"[object Object]"===Object.prototype.toString.call(i)&&e.rule&&e.target?n.replace(e.rule,e.target):(t=e,"[object Function]"===Object.prototype.toString.call(t)?e(n):(o(e)&&k(e,function(e,t){n=f(n,t)}),n)))):n;var t,i,a}function i(e){var t=/\?(.+)/.exec(e),n=t&&t[1],i={};return n&&k(n.split("&"),function(e,t){var n=t.split("=");i[n[0]]=n[1]||""}),i}function e(e,t){return"imageView"in(t=t||i(e))||!!t.param&&/^\d+[xyz]\d+$/.test(t.param)}function s(){return!!window.PRELOAD}function D(e){if(!e)return"";var t={};return t.className=e.className||"",t.id=e.id||"",t.nodeName=e.nodeName||"",t}var c={};try{c.Set=Set}catch(e){!function(n,t){var e=t(i.prototype,{size:{configurable:!0,get:function(){return this._v.length}}});function i(e){t(this,{_v:{value:[]}}),e&&e.forEach(this.add,this)}function a(e,t){return-1<(n=e._v.indexOf(t))}function o(e){return[e,e]}e.add=function(e){return a(this,e)||this._v.push(e),this},e.clear=function(){var e=this._v.length;this._v.splice(0,e)},e.delete=function(e){return a(this,e)&&!!this._v.splice(n,1)},e.entries=function(){return this._v.map(o)},e.forEach=function(n,i){this._v.forEach(function(e,t){n.call(i,e,e,this)},this)},e.has=function(e){return a(this,e)},e.keys=e.values=function(){return this._v.slice(0)},c.Set=i}(0,Object.defineProperties)}var n=c.Set;"function"!=typeof window.Set&&(window.Set=n),Array.prototype.filter||(Array.prototype.filter=function(e,t){if("Function"!=typeof e&&"function"!=typeof e||!this)throw new TypeError;var n=this.length>>>0,i=new Array(n),a=this,o=0,r=-1;if(void 0===t)for(;++r!==n;)r in this&&e(a[r],r,a)&&(i[o++]=a[r]);else for(;++r!==n;)r in this&&e.call(t,a[r],r,a)&&(i[o++]=a[r]);return i.length=o,i}),Array.prototype.map||(Array.prototype.map=function(e){var t,n,i;if(null==this)throw new TypeError("this is null or not defined");var a=Object(this),o=a.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(1<arguments.length&&(t=arguments[1]),n=new Array(o),i=0;i<o;){var r,s;i in a&&(r=a[i],s=e.call(t,r,i,a),n[i]=s),i++}return n});var A,I,a,x,M=function(e,t){return{name:e,value:void 0===t?-1:t,delta:0,entries:[],id:"v1-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12)}},q=function(e,t){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){if("first-input"===e&&!("PerformanceEventTiming"in self))return;var n=new PerformanceObserver(function(e){return e.getEntries().map(t)});return n.observe({type:e,buffered:!0}),n}}catch(e){}},N=function(n,i){var e=function e(t){"pagehide"!==t.type&&"hidden"!==document.visibilityState||(n(t),i&&(removeEventListener("visibilitychange",e,!0),removeEventListener("pagehide",e,!0)))};addEventListener("visibilitychange",e,!0),addEventListener("pagehide",e,!0)},U=function(t){addEventListener("pageshow",function(e){e.persisted&&t(e)},!0)},j="function"==typeof WeakSet?new WeakSet:new Set,W=function(e,t,n){var i;return function(){0<=t.value&&(n||j.has(t)||"hidden"===document.visibilityState)&&(t.delta=t.value-(i||0),(t.delta||void 0===i)&&(i=t.value,e(t)))}},u=-1,l=function(){return"hidden"===document.visibilityState?0:1/0},d=function(){N(function(e){var t=e.timeStamp;u=t},!0)},F=function(){return u<0&&(u=l(),d(),U(function(){setTimeout(function(){u=l(),d()},0)})),{get timeStamp(){return u}}},m={passive:!0,capture:!0},v=new Date,g=function(e,t){A||(A=t,I=e,a=new Date,H(removeEventListener),B())},B=function(){if(0<=I&&I<a-v){var t={entryType:"first-input",name:A.type,target:A.target,cancelable:A.cancelable,startTime:A.timeStamp,processingStart:A.timeStamp+I};x.forEach(function(e){e(t)}),x=[]}},h=function(e){if(e.cancelable){var t=(1e12<e.timeStamp?new Date:performance.now())-e.timeStamp;"pointerdown"==e.type?(n=t,i=e,a=function(){g(n,i),r()},o=function(){r()},r=function(){removeEventListener("pointerup",a,m),removeEventListener("pointercancel",o,m)},addEventListener("pointerup",a,m),addEventListener("pointercancel",o,m)):g(t,e)}var n,i,a,o,r},H=function(t){["mousedown","keydown","touchstart","pointerdown"].forEach(function(e){return t(e,h,m)})};function w(t){var e=window.MNB;if(!e||!e.addMethod)return t(new Error("mnb sdk missing"));e.addMethod({schema:"performance.getInfo",name:"getClientPerformance"});var n=setTimeout(function(){if(n)return t(new Error("mnb performance.getInfo timeout"))},200),i=function(){n&&(clearTimeout(n),n=void 0)};e.getClientPerformance({},function(e){i(),t(null,e)},function(e){i(),t(new Error("mnb performance.getInfo failed:"+e.message))})}function V(n){var i={navTiming:function(){var e=window.performance&&window.performance.timing||{},t={};for(var n in e)"toJSON"!==n&&(t[n]=e[n]);return t}()};if(window.PRELOAD&&window.PRELOAD.timing)return i.preload=window.PRELOAD.timing,n(i);w(function(e,t){return e||(i.clientTiming=t),n(i)})}var _="https://sentry.music.163.com/wapm",y="https://sentry.music.163.com/wapm-log",S="/api/sdk/collectConfig",E="/api/sdk/collect",b=_+S,L=_+E,O=y+E,T="_mwapm_uid",P="_WAPM_CACHE",R=["longtask","image"],C=["longtask","image","webVitals"];function z(){this._key=null,this._isInstalled=!1,this._pid=null,this._version="1.6.8",this._globalOptions={traceResource:!1,traceLongtask:!0,enableSPA:!1,hashSPA:!1,debug:!1,syncConfig:!0,ignoreUrlPath:[{rule:/\/\d+\//g,target:"/**/"},{rule:/\/\d+\//g,target:"/**/"},{rule:/\/\d+$/g,target:"/**"}],traceImage:!0,warningImageSize:10,filterCropImg:!0,hasCropParams:e,sampleRate:1,vitalsBadline:{LCP:3500,CLS:.2,FID:300},pendingRequest:!1,udfCDNHostRegString:""},this._payloadTransform=function(e){return e},this._cache=new J,this._fetchDefaults={method:"POST",headers:{"Content-type":"application/json"}},this._uploadedImage={},this._requestCache=[]}function J(){this._pidMap={},this._handlerMap={},this._intervalMap={}}return z.prototype={debug:!1,install:function(e,t){var n,i,a,o,r,s,c=this;if(c._isInstalled)c._logDebug("warn","Warn: music-apm has already been installed");else{if(!e)return void console.error("错误: musicapm安装失败，请传递参数appkey");if(c._key=e,c._onLoadHandlers=[],window[P]&&window[P].loginUser&&c.login(window[P].loginUser),t&&k(t,function(e,t){var n;"sampleRate"===e&&(!(n=t)||n<0||1<n)&&(t=1),c._globalOptions[e]=t}),Math.random()>c._globalOptions.sampleRate)return;if(c._isInstalled=!0,function(e){if(window.dispatchEvent){var t=document.createEvent("Event");t.initEvent(e,!0,!0),window.dispatchEvent(t)}else console.log("window.dispatchEvent is not available")}("music_apm_installed"),c._globalOptions.uploadServer&&(_=c._globalOptions.uploadServer,b=_+S,L=_+E),c._globalOptions.uploadServerV2&&(y=c._globalOptions.uploadServerV2,O=y+E),c._globalOptions.useOverseaDomain&&(s=window.location.hostname,/(baechat\.my|kayalive\.tv|mimotest\.top|meety\.my)/.test(s))){var u=_.includes("qa-wapm.igame.163.com");n=u,i={test:"//qa.meety.my",online:"//api.baechat.my"},a={test:"//qa.mimotest.top",online:"//api.kayalive.tv"},o=window.location.hostname,r=a.online,k({"meety.my":i,"baechat.my":i,"mimotest.top":a,"kayalive.tv":a},function(e,t){o.includes(e)&&(r=n?t.test:t.online)}),b=(_=r)+"/api/wapm-sdk/collectConfig",L=_+"/api/wapm-sdk/collect"}c._globalOptions.enableSPA&&c._traceSPA(),c.tracePageView(),c._globalOptions.syncConfig?c._syncServerConfig(function(){c._startTrace(),c._startUpload()}):(c._startTrace(),c._startUpload())}return c},_traceSPA:function(){var i=this,e=function(t,e){if(t[e]){var n=t[e];t[e]=function(){var e=n.apply(t,arguments);return i.tracePageView(),e}}};e(window.history,"pushState"),e(window.history,"replaceState"),window.addEventListener("popstate",function(){i.tracePageView()})},_syncServerConfig:function(n){var i=this,e={url:b,method:"GET",payload:{appKey:i._key},onSuccess:function(e){var t=e&&e.result;i._globalOptions.traceResource=t&&t.traceResource,i._globalOptions.traceLongtask=t&&t.traceLongtask,n()},onError:function(e){i._globalOptions.traceResource=!1,i._globalOptions.traceLongtask=!1,i._logDebug("error",e),n()}};i._makeRequest(e)},_startTrace:function(){this._traceNavigation(),this._traceWebVitals();var e=this._globalOptions;e.traceResource&&this._traceResource(),e.traceLongtask&&this._traceLongtask(),e.traceImage&&this._traceImage()},_startUpload:function(){var i=this;k(i._onLoadHandlers,function(e,t){"complete"===document.readyState?t():window.addEventListener?window.addEventListener("load",t):document.attachEvent&&window.attachEvent("onload",t)});var e,a=i._globalOptions;k(R,function(e,n){var t;a["trace"+(t=n,t[0].toUpperCase()+t.slice(1))]&&i._cache.subscribeTiming(n,function(e,t){i._upload(e,n,t)},5e3)});var t=window[P];if(t&&t.eventList?e=t.eventList:window._wapm_cache&&(e=window._wapm_cache),e&&e.length){var n=[];k(e,function(e,t){t&&t.name?n.push(t):this._logDebug("warn","WAPM::uploadEvent fail: absence of event.name")}),i._uploadEvents(n)}},_traceNavigation:function(){var i=this,t=!1,a=function(){var e=window.performance&&window.performance.timing;if(e&&(!t||0!==e.loadEventStart))if(0!==e.loadEventStart&&0!==e.domInteractive){i._navigationStart=e.navigationStart;var n={};n.begin=e.navigationStart,n.unload=e.unloadEventEnd-e.unloadEventStart,n.redirect=e.fetchStart-e.navigationStart,n.dns=e.domainLookupEnd-e.domainLookupStart,n.tcp=e.connectEnd-e.connectStart,n.ssl=e.secureConnectionStart?e.connectEnd-e.secureConnectionStart:0,n.ttfb=e.responseStart-e.requestStart,n.trans=e.responseEnd-e.responseStart,n.dom=e.domInteractive-e.responseEnd,n.res=e.loadEventStart-e.domContentLoadedEventEnd,n.firstbyte=e.responseStart-e.domainLookupStart,n.fpt=e.responseEnd-e.navigationStart,n.tti=e.domInteractive-e.navigationStart,n.ready=e.domContentLoadedEventEnd-e.navigationStart,n.load=e.loadEventStart-e.navigationStart,n.retry=t?1:0,k(n,function(e,t){"begin"!==e&&t>n.begin&&(n[e]=t-n.begin)}),s()?function(e){if(s()){var t=(n=0,function(){if(window.PRELOAD.timing)return e(null,window.PRELOAD.timing);n<=2?(n++,setTimeout(t,200)):e(new Error("get preload timing timeout"))});t()}else e(new Error("cant get preload timing, please check window.PRELOAD has exist ?"));var n}(function(e,t){if(e)return i._logDebug("warn","WAPM::preload"+e.message),void i._upload(i._pid,"navigation",[n]);i._upload(i._pid,"navigationPreload",[n,t])}):w(function(e,t){if(e)return i._logDebug("warn","WAPM::mnb "+e.message),void i._upload(i._pid,"navigation",[n]);i._upload(i._pid,"navigation",[n,t])})}else t||(t=!0,setTimeout(a,1e3))};i._onLoadHandlers.push(a)},_traceResource:function(){var t=this;t._onLoadHandlers.push(function(){try{var e=window.performance.getEntriesByType("resource");t._upload(t._pid,"resource",(i=[],k(e,function(e,t){if(!t.name.startsWith(L)&&!t.name.startsWith(b)){var n={};n.name=t.name,n.type=t.initiatorType,n.encodedBodySize=t.encodedBodySize,n.startTime=t.startTime,n.duration=t.duration,n.dns=t.domainLookupEnd-t.domainLookupStart,n.tcp=t.connectEnd-t.connectStart,n.ttfb=t.responseStart-t.requestStart,n.trans=t.responseStart?t.responseEnd-t.responseStart:0,i.push(n)}}),i),!1,!0)}catch(e){t._logDebug("warn","warn: 浏览器不支持获取resource timing,"+e)}var i})},_traceLongtask:function(){var a=this;this._observerTiming("longtask",function(e){var i=[];return k(e,function(e,t){var n={};n.navigationStart=a._navigationStart,n.startTime=t.startTime,n.duration=t.duration,n.name=t.name,"self"!==t.name&&(n.containerSrc=t.attribution[0].containerSrc),i.push(n)}),i})},_traceImage:function(){var n=this,t=function(e){return e.filter(function(e){if("css"!==e.initiatorType&&"img"!==e.initiatorType)return!1;if(t=e.name,!/p[1-6]c?\.music\.126\.net|s[1-8]c?\.music\.126\.net/i.test(t)&&!/p\d+.baecdn.com/.test(t)&&!function(e,t){if(!e)return!1;try{return new RegExp(e).test(t)}catch(e){console.log("WAPM::isRegexMatch",e)}}(n._globalOptions.udfCDNHostRegString,e.name))return!1;var t;if("wapm_ignore"in i(e.name))return!1;try{if(n._globalOptions.filterCropImg&&n._globalOptions.hasCropParams&&n._globalOptions.hasCropParams(e.name,i(e.name)))return!1}catch(e){n._logDebug("error",e)}return!(!e.transferSize||e.transferSize<1024*n._globalOptions.warningImageSize)&&(!n._uploadedImage[e.name]&&(n._uploadedImage[e.name]=!0))}).map(function(e){var t="";"img"===e.initiatorType&&(t=function(e){if(e instanceof window.Element){for(var t=[];e.nodeType===window.Node.ELEMENT_NODE;){var n=e.nodeName.toLowerCase(),i=n,a=e.className.trim();if(a&&(i+="."+a),e.id&&(i+="#"+e.id),!s([i].concat(t))){for(var o=e,r=1;o=o.previousElementSibling;)o.nodeName.toLowerCase()===n&&r++;i+=":nth-of-type("+r+")"}if(t.unshift(i),s(t))break;e=e.parentNode}return t.join(" > ")}function s(e){try{return 1===document.querySelectorAll(e.join(" > ")).length}catch(e){return!0}}}(document.querySelector('img[src="'+e.name+'"]')));return{name:e.name,transferSize:e.transferSize,initiatorType:e.initiatorType,domPath:t}})};n._onLoadHandlers.push(function(){try{var e=window.performance.getEntriesByType("resource");n._cache.pushTiming(n._pid,"image",t(e))}catch(e){n._logDebug("warn","warn: 浏览器不支持获取resource timing,"+e)}}),this._observerTiming("image",function(e){return t(e)})},_traceWebVitals:function(){if(window.performance.getEntriesByName){var t,n,i,a,o,e,r,s,c,u,l,d,p,f,m,v,g,h,w,_,y,S=this,E={DETAIL:{}},b=["FCP","LCP"],L=window.PRELOAD&&window.PRELOAD.timing?window.PRELOAD.timing.show-window.performance.timing.navigationStart:0;"complete"===document.readyState?P():window.addEventListener("load",P),t=R,a=F(),o=M("FCP"),e=function(e){"first-contentful-paint"===e.name&&(s&&s.disconnect(),e.startTime<a.timeStamp&&(o.value=e.startTime,o.entries.push(e),j.add(o),i()))},r=performance.getEntriesByName("first-contentful-paint")[0],s=r?null:q("paint",e),(r||s)&&(i=W(t,o,n),r&&e(r),U(function(e){o=M("FCP"),i=W(t,o,n),requestAnimationFrame(function(){requestAnimationFrame(function(){o.value=performance.now()-e.timeStamp,j.add(o),i()})})})),function(t,n){var i,a=F(),o=M("LCP"),e=function(e){var t=e.startTime;t<a.timeStamp&&(o.value=t,o.entries.push(e)),i()},r=q("largest-contentful-paint",e);if(r){i=W(t,o,n);var s=function(){j.has(o)||(r.takeRecords().map(e),r.disconnect(),j.add(o),i())};["keydown","click"].forEach(function(e){addEventListener(e,s,{once:!0,capture:!0})}),N(s,!0),U(function(e){o=M("LCP"),i=W(t,o,n),requestAnimationFrame(function(){requestAnimationFrame(function(){o.value=performance.now()-e.timeStamp,j.add(o),i()})})})}}(R),c=R,d=M("CLS",0),(f=q("layout-shift",p=function(e){e.hadRecentInput||(d.value+=e.value,d.entries.push(e),l())}))&&(l=W(c,d,u),N(function(){f.takeRecords().map(p),l()}),U(function(){d=M("CLS",0),l=W(c,d,u)})),m=R,h=F(),w=M("FID"),y=q("first-input",_=function(e){e.startTime<h.timeStamp&&(w.value=e.processingStart-e.startTime,w.entries.push(e),j.add(w),g())}),g=W(m,w,v),y&&N(function(){y.takeRecords().map(_),y.disconnect()},!0),y&&U(function(){var e;w=M("FID"),g=W(m,w,v),x=[],I=-1,A=null,H(addEventListener),e=_,x.push(e),B()});var O=!1,T=S._pid;window.addEventListener&&setTimeout(function(){!function(e){if(-1!==(window.PerformanceObserver&&window.PerformanceObserver.supportedEntryTypes||[]).indexOf("layout-shift")){var t=function(){"hidden"===document.visibilityState&&(e(),window.removeEventListener("visibilitychange",t,!0))};window.addEventListener("visibilitychange",t,!0)}else window.addEventListener("pagehide",e,{capture:!0,once:!0})}(C)})}function P(){V(function(e){E.EXTRA=e})}function R(e){var t=e.name,n=b.includes(t)?e.value-L:e.value;E[t]=n;var i,a=S._globalOptions.vitalsBadline;if(a&&a[t]&&n>=a[t]){var o,r,s=E.DETAIL;switch(t){case"LCP":if(!(r=e.entries[e.entries.length-1]))return;o={largestContentfulPaint:n,largestContentfulElement:D(r.element),largestContentfulElementSize:r.size};break;case"FID":if(!(r=e.entries[0]))return;o={firstInputDelay:e.value,firstInputName:r.name,firstInputTime:r.startTime,firstInputElement:D(r.target)};break;case"CLS":var c=[],u=0;k(e.entries,function(e,t){var n,i;c.push({value:t.value,startTime:t.startTime,sources:(n=t.sources,i=[],n&&k(n,function(e,t){i.push({currentRect:JSON.stringify(t.currentRect),previousRect:JSON.stringify(t.previousRect),node:D(t.node)})}),i)}),t.value>u&&(u=t.value)}),o={cumulativeLayoutShift:e.value,largestLayoutShift:u,totalLayoutShifts:c,viewport:(i=document.scrollingElement,i?{width:i.clientWidth,height:i.clientHeight}:null)}}s[t]=o}}function C(){E.LCP&&E.EXTRA&&!O&&(S._upload(T,"webVitals",[E],!0),O=!0)}},_observerTiming:function(n,i){if(window.PerformanceObserver){var a=this,e=new window.PerformanceObserver(function(e){var t=i?i(e.getEntries()):e.getEntries();t&&0<t.length&&a._cache.pushTiming(a._pid,n,t)}),t="image"===n?"resource":n;try{e.observe({entryTypes:[t]})}catch(e){a._logDebug("warn","warn: 浏览器不支持检测"+t)}}},_upload:function(e,t,n,i,a){if(this._isInstalled){var o,r,s=this,c={},u=(o=t,r=!1,k(C,function(e,t){t===o&&(r=!0)}),r?s._cache.getLocation(e):window.location),l=u&&u.host+u.pathname+(s._globalOptions.hashSPA?u.hash.replace(/\?.+/,""):"");l=f(l,s._globalOptions.ignoreUrlPath),p(c,{appKey:s._key,dataType:t,data:n,uid:s._getUserId(),pid:e,href:u&&u.href,url:l,sampleRate:s._globalOptions.sampleRate,version:s._version,network:s._getNetwork(),hashSpa:s._globalOptions.hashSPA});var d={url:a?O:L,payload:c,onError:function(e){s._logDebug("error",e)},useBeacon:i};s._globalOptions.pendingRequest?s._requestCache.push(d):s._makeRequest(d)}},_makeRequest:function(t){var n=this;t.payload=n._payloadTransform(p({},t.payload))||t.payload;var e=t.url;if("GET"===t.method&&(e=e+"?"+function(e){if("object"!=typeof e)return"";var n="";return k(e,function(e,t){n+=e+"="+encodeURIComponent(t)+"&"}),n.slice(0,n.length-1)}(t.payload)),"sendBeacon"in navigator&&t.useBeacon)return navigator.sendBeacon(e,JSON.stringify(t.payload));if(function(){if(!("fetch"in window))return!1;try{new Headers,new Request(""),new Response}catch(e){return!1}return!0}()){var i={};return t.method&&"GET"===t.method||(i=p({body:JSON.stringify(t.payload)},this._fetchDefaults)),window.fetch(e,i).then(function(e){if(e.ok)return e.json();var t=new Error("APM error code:"+e.status);throw t.request=e,t}).then(function(e){t.onSuccess&&t.onSuccess(e)}).catch(function(e){n._logDebug("error",e),t.onError&&t.onError(e)})}var a=window.XMLHttpRequest&&new window.XMLHttpRequest;a&&(("withCredentials"in a||"undefined"!=typeof XDomainRequest)&&("withCredentials"in a?a.onreadystatechange=function(){if(4!==a.readyState);else if(200===a.status)t.onSuccess&&t.onSuccess();else if(t.onError){var e=new Error("APM error code:"+a.status);e.request=a,t.onError(e)}}:window.XDomainRequest&&(a=new window.XDomainRequest,e=e.replace(/^https?:/,""),t.onSuccess&&(a.onload=t.onSuccess),t.onError&&(a.onerror=function(){var e=new Error("APM error code: XDomainRequest");e.request=a,t.onError(e)})),"GET"===t.method?(a.open("GET",e),a.send()):(a.open("POST",e),a.setRequestHeader("Content-type","application/json"),a.send(JSON.stringify(t.payload)))))},_logDebug:function(e){console[e]&&(this.debug||this._globalOptions.debug)&&Function.prototype.apply.call(console[e],console,[].slice.call(arguments,1))},login:function(e){e&&"string"==typeof e&&this._setUserId(e)},_setUserId:function(e){var t,n,i,a,o,r,s;window.localStorage?window.localStorage.setItem(T,e):(t=T,n=e,i=new Date(Date.now()+31536e6),a="/",s=encodeURIComponent(t)+"="+encodeURIComponent(n),i instanceof Date&&(s+="; expires="+i.toGMTString()),a&&(s+="; path="+a),o&&(s+="; domain="+o),r&&(s+="; secure"),document.cookie=s)},_getUserId:function(){var e=null;return(e=window.localStorage?window.localStorage.getItem(T):function(e){var t=encodeURIComponent(e)+"=",n=document.cookie.indexOf(t),i=null;if(-1<n){var a=document.cookie.indexOf(";",n);-1===a&&(a=document.cookie.length),i=decodeURIComponent(document.cookie.substring(n+t.length,a))}return i}(T))||(e=t(),this._setUserId(e)),e},_getNetwork:function(){var e=navigator.connection;return e?{effectiveType:e.effectiveType,rtt:e.rtt}:null},tracePageView:function(){this._pid=t(),this._cache.initCache(this._pid),this._upload(this._pid,"pv")},traceEvent:function(e,t){this._logDebug("warn","WAPM::traceEvent is depressed, please use uploadEvent instead"),this._upload(this._pid,"event",[{name:e,attributes:t}])},uploadEvent:function(e){e&&e.name?this._uploadEvents([{name:e.name,attributes:e.attributes,value:e.value}]):this._logDebug("warn","WAPM::uploadEvent fail: absence of event.name")},uploadEvents:function(e){if(e&&o(e)){var n=!1;k(e,function(e,t){t.name||(n=!0)}),n?this._logDebug("warn","WAPM::uploadEvents fail: absence of event.name"):this._uploadEvents(e)}else this._logDebug("warn","WAPM::uploadEvents fail: should pass array")},_uploadEvents:function(e){this._upload(this._pid,"event",e)},setPayloadTransform:function(e){if(e){var n=this;n._payloadTransform=function(t){try{return e(t)}catch(e){return n._logDebug("error",e),t}}}},flushPendingRequest:function(){var n=this;n._globalOptions.pendingRequest=!1,n._requestCache.length&&(k(n._requestCache,function(e,t){n._makeRequest(t)}),n._requestCache.length=0)}},J.prototype={initCache:function(e){var n={};return k(R,function(e,t){n[t]=[]}),this._pidMap[e]={cache:n,location:JSON.parse(JSON.stringify(window.location))},this._pidMap[e]},getLocation:function(e){return this._pidMap[e]&&this._pidMap[e].location},_getPidCache:function(e){return this._pidMap[e]||this.initCache(e),this._pidMap[e].cache},pushTiming:function(e,n,t){var i=this._getPidCache(e);o(t)?k(t,function(e,t){i[n].push(t)}):i[n].push(t)},subscribeTiming:function(i,a,e){var t=this,n=t._intervalMap[i];n&&clearInterval(n);var o=function(){k(t._pidMap,function(e,t){var n=t.cache[i];n&&0<n.length&&a(e,n.splice(0,n.length))})};e&&(t._intervalMap[i]=setInterval(o,e)),t._handlerMap[i]=o}},new z}();
